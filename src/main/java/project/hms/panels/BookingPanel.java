package project.hms.panels;

import java.awt.Color;
import java.awt.Dimension;
import java.time.LocalDate;
import java.time.LocalTime;


import project.hms.models.BookingData;
import project.hms.models.PatientData;
import project.hms.models.StaffData;
import project.hms.services.BookingService;
import project.hms.services.PatientRecordService;
import project.hms.services.StaffRecordService;
import project.hms.utils.SessionManager;

public class BookingPanel extends javax.swing.JPanel {
    
private final BookingService bookingService = new BookingService();
private final PatientRecordService patientRecordService = new PatientRecordService();
private final StaffRecordService staffRecordService = new StaffRecordService();

    public BookingPanel() {
        initComponents();
        setPreferredSize(new Dimension(900, 650));
        setBackground(new Color(0, 0, 0, 0.2f));
        monthField.setText("mm");
        dayField.setText("dd");
        yearField.setText("yyyy");
        hourField.setText("hh");
    }

    /**
     * This method is called from within the constructor to initialize the form. WARNING: Do NOT modify this code. The content of this method is always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        usernameLabel2 = new javax.swing.JLabel();
        signupBTN = new javax.swing.JButton();
        staffIdField = new javax.swing.JTextField();
        usernameLabel = new javax.swing.JLabel();
        passwordLabel = new javax.swing.JLabel();
        usernameLabel1 = new javax.swing.JLabel();
        patientIdField = new javax.swing.JTextField();
        monthField = new javax.swing.JTextField();
        dayField = new javax.swing.JTextField();
        yearField = new javax.swing.JTextField();
        hourField = new javax.swing.JTextField();
        statusField = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        textArea = new javax.swing.JTextArea();

        usernameLabel2.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        usernameLabel2.setForeground(new java.awt.Color(255, 255, 255));
        usernameLabel2.setText("Appointment Sched:");

        signupBTN.setBackground(new java.awt.Color(102, 102, 102));
        signupBTN.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        signupBTN.setForeground(new java.awt.Color(255, 255, 255));
        signupBTN.setText("Book");
        signupBTN.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                signupBTNActionPerformed(evt);
            }
        });

        staffIdField.setBackground(new java.awt.Color(102, 102, 102));
        staffIdField.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        staffIdField.setForeground(new java.awt.Color(255, 255, 255));
        staffIdField.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        staffIdField.setCaretColor(new java.awt.Color(255, 255, 255));

        usernameLabel.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        usernameLabel.setForeground(new java.awt.Color(255, 255, 255));
        usernameLabel.setText("Staff ID:");

        passwordLabel.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        passwordLabel.setForeground(new java.awt.Color(255, 255, 255));
        passwordLabel.setText("status:");

        usernameLabel1.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        usernameLabel1.setForeground(new java.awt.Color(255, 255, 255));
        usernameLabel1.setText("Patient ID:");

        patientIdField.setBackground(new java.awt.Color(102, 102, 102));
        patientIdField.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        patientIdField.setForeground(new java.awt.Color(255, 255, 255));
        patientIdField.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        patientIdField.setCaretColor(new java.awt.Color(255, 255, 255));
        patientIdField.setCursor(new java.awt.Cursor(java.awt.Cursor.TEXT_CURSOR));

        monthField.setBackground(new java.awt.Color(102, 102, 102));
        monthField.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        monthField.setForeground(new java.awt.Color(255, 255, 255));
        monthField.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        monthField.setCaretColor(new java.awt.Color(255, 255, 255));
        monthField.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                monthFieldFocusGained(evt);
            }
        });

        dayField.setBackground(new java.awt.Color(102, 102, 102));
        dayField.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        dayField.setForeground(new java.awt.Color(255, 255, 255));
        dayField.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        dayField.setCaretColor(new java.awt.Color(255, 255, 255));
        dayField.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                dayFieldFocusGained(evt);
            }
        });

        yearField.setBackground(new java.awt.Color(102, 102, 102));
        yearField.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        yearField.setForeground(new java.awt.Color(255, 255, 255));
        yearField.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        yearField.setCaretColor(new java.awt.Color(255, 255, 255));

        hourField.setBackground(new java.awt.Color(102, 102, 102));
        hourField.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        hourField.setForeground(new java.awt.Color(255, 255, 255));
        hourField.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        hourField.setCaretColor(new java.awt.Color(255, 255, 255));
        hourField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                hourFieldActionPerformed(evt);
            }
        });

        statusField.setBackground(new java.awt.Color(102, 102, 102));
        statusField.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        statusField.setForeground(new java.awt.Color(255, 255, 255));
        statusField.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        statusField.setCaretColor(new java.awt.Color(255, 255, 255));

        jScrollPane1.setBackground(new java.awt.Color(102, 102, 102));

        textArea.setBackground(new java.awt.Color(50, 50, 50));
        textArea.setColumns(20);
        textArea.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        textArea.setForeground(new java.awt.Color(255, 255, 255));
        textArea.setRows(5);
        textArea.setBorder(javax.swing.BorderFactory.createEtchedBorder(null, java.awt.Color.black));
        textArea.setCaretColor(new java.awt.Color(255, 255, 255));
        jScrollPane1.setViewportView(textArea);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(68, 68, 68)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 390, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(signupBTN, javax.swing.GroupLayout.PREFERRED_SIZE, 84, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(176, 176, 176)))
                        .addContainerGap(175, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(usernameLabel)
                            .addComponent(usernameLabel1)
                            .addComponent(passwordLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 123, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(usernameLabel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addComponent(staffIdField, javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(patientIdField)
                                .addComponent(statusField, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 106, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(monthField, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(dayField, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(yearField, javax.swing.GroupLayout.PREFERRED_SIZE, 79, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(hourField, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(118, 118, 118))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(108, 108, 108)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(3, 3, 3)
                        .addComponent(usernameLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(usernameLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(patientIdField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(staffIdField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(9, 9, 9)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(monthField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(usernameLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(dayField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(yearField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(hourField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(passwordLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(statusField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(signupBTN)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(43, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void signupBTNActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_signupBTNActionPerformed
        handleBook();
    }//GEN-LAST:event_signupBTNActionPerformed

    private void hourFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_hourFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_hourFieldActionPerformed

    private void monthFieldFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_monthFieldFocusGained
        monthField.setText("");
    }//GEN-LAST:event_monthFieldFocusGained

    private void dayFieldFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_dayFieldFocusGained
        dayField.setText("");
    }//GEN-LAST:event_dayFieldFocusGained
    private void handleBook(){
        int patientID = Integer.parseInt(patientIdField.getText().trim());
        int staffID = Integer.parseInt(staffIdField.getText().trim());
        int month = Integer.parseInt(monthField.getText().trim());
        int day = Integer.parseInt(dayField.getText().trim());
        int year = Integer.parseInt(yearField.getText().trim());
        LocalDate date = LocalDate.of(year, month, day);
        int hour = Integer.parseInt(hourField.getText().trim());

        String formattedTime = String.format("%02d:00", hour);
        LocalTime time = LocalTime.parse(formattedTime);
        String status = statusField.getText();
        String handler = SessionManager.getUsername();
        BookingData bookingData = new BookingData(0, patientID, staffID, date, time, status, handler, LocalDate.now(), LocalTime.now());
        boolean bookAppointment = bookingService.BookAppointment(bookingData);
        clearField();
        
        PatientData searchPatient = patientRecordService.searchPatientRecord(patientID);
        StaffData searchStaff = staffRecordService.searchStaffRecord(staffID);
        textArea.setText("Patient: " + searchPatient.getName() +
                        "\nStaff: " + searchStaff.getName() +
                        "\nAppointment at: " + String.valueOf(date) + " " + String.valueOf(time) +
                        "\nAppointed by: " + handler
        );
    }
    
    private void clearField(){
        patientIdField.setText("");
        staffIdField.setText("");
        monthField.setText("mm");
        dayField.setText("dd");
        yearField.setText("yyyy");
        hourField.setText("hh");
        statusField.setText("");
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField dayField;
    private javax.swing.JTextField hourField;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextField monthField;
    private javax.swing.JLabel passwordLabel;
    private javax.swing.JTextField patientIdField;
    private javax.swing.JButton signupBTN;
    private javax.swing.JTextField staffIdField;
    private javax.swing.JTextField statusField;
    private javax.swing.JTextArea textArea;
    private javax.swing.JLabel usernameLabel;
    private javax.swing.JLabel usernameLabel1;
    private javax.swing.JLabel usernameLabel2;
    private javax.swing.JTextField yearField;
    // End of variables declaration//GEN-END:variables
}
